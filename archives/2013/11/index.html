<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><meta name="description" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta name="keywords" /><meta content="Justin Proffitt" name="author" /><link href="/images/favicon.ico" rel="icon" type="image/x-icon" /><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="/bootstrap/boot3/css/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="/prettify/prettify.css" rel="stylesheet" type="text/css" /><script src="/prettify/prettify.js" type="text/javascript"></script><link href="http://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet" type="text/css" /><link href="/screen.css" rel="stylesheet" type="text/css" /><title>Archives</title><style>.prettyprint ol.linenums > li {list-style-type: decimal;}</style><body onload="prettyPrint()"><div id="wrap"><div class="container" id="header"><div class="row"><div class="col-xs-12 col-sm-12 col-md-offset-2 col-md-8"><h1><a href="http://jprof.github.io">The Palavering Proffitt</a></h1><div class="nav-list pages"><ul><li><a class="page" href="/">Home</a></li><li><a class="page" href="/about.html">About</a></li><li><a class="page" href="https://github.com/jprof">GitHub</a></li><li><a class="page" href="https://twitter.com/jdprof">Twitter</a></li></ul></div></div></div><div class="row"><div class="col-xs-12 col-sm-offset-1 col-sm-10 col-md-offset-2 col-md-8"><div class="top-bottom-border" id="content"><div><h2><a href="/2013/11/21/getting-started-with-clojurescript/">Getting started with ClojureScript</a></h2><p class="publish_date">21 Nov 2013</p><p><p>I recently attended <a href="http://clojure-conj.org/">Clojure Conj</a> and had a wonderful time. I've been doing things in Clojure whenever I can find a good fit for it, but at the conference I was inspired to take a look at ClojureScript when I saw <a href="http://github.com/MarcoPolo">MarcoPolo</a>'s <a href="http://github.com/MarcoPolo/Transcience">Transcience</a> game which was written in ClojureScript.</p><p>I sat down last night with aspirations to dig in and get something started (likely a game for the <a href="https://github.com/blog/1674-github-game-off-ii">Github Gameoff</a>) but quickly realized that ClojureScript development didn't flow quite as smoothly as Clojure development. My impression so far has been that this is mostly due to the short time ClojureScript has been in the wild. With that said, I wanted to outline my first steps, where I went wrong, and specifically: how to get a browser attached ClojureScript repl going.</p><h3>Getting Started</h3><p>I'm going to assume that you already have lein installed. If not, the installation is very simple and can be found on the <a href="http://github.com/technomancy/leiningen">leiningen</a> github page.</p><p>The first step, as always, is to create a new project.</p><p><code>lein new try-cljs</code></p><p>We next need to edit our project.clj file to pull in ClojureScript. This can be done by adding <code>[org.clojure/ClojureScript &quot;0.0.2030&quot;]</code> to the <code>:dependencies</code> vector. We will also want the <a href="https://github.com/emezeske/lein-cljsbuild">lein-cljsbuild</a> plugin. Add a <code>:plugin</code> keyword with <code>[[lein-cljsbuild &quot;1.0.0&quot;]]</code> as the value to accomplish this.</p><p>The lein-cljsbuild plugin is configured via the <code>:cljsbuild</code> key, taking a map as the value. We'll use something similar to what's found in the <a href="https://github.com/emezeske/lein-cljsbuild/blob/1.0.0/example-projects/simple/project.clj">simple example project</a> of the lein-cljsbuild github repo. It looks something like:</p>
<pre><code class="prettyprint lang-clj linenums">:builds [{:source-paths [&quot;src-cljs&quot;]
          :compiler {:output-to &quot;js/main.js&quot;
                     :output-dir &quot;out&quot;
                     :pretty-print true}}]}
</code></pre><p>At this point your project.clj contents should look like:</p>
<pre><code class="prettyprint lang-clj linenums">(defproject try-cljs &quot;0.1.0-SNAPSHOT&quot;
  :description &quot;FIXME: write description&quot;
  :url &quot;http://example.com/FIXME&quot;
  :license {:name &quot;Eclipse Public License&quot;
            :url &quot;http://www.eclipse.org/legal/epl-v10.html&quot;}
  :dependencies [[org.clojure/clojure &quot;1.5.1&quot;]
                 [org.clojure/clojurescript &quot;0.0-2030&quot;]]
  :plugins [[lein-cljsbuild &quot;1.0.0&quot;]]
  :cljsbuild {:builds [{:source-paths [&quot;src-cljs&quot;]
                        :compiler {:output-to &quot;js/main.js&quot;
                                   :output-dir &quot;out&quot;
                                   :pretty-print true}}]})
</code></pre><p>Now run <code>lein deps</code> to pull these dependencies. Once that has finished, it's time to write some ClojureScript! Since we have specified in our project.clj that our cljs src is in <code>src-cljs</code>, we must make this directory. <code>mkdir -p
src-cljs/try-cljs/</code>. Now, using your favorite editor, let's create <code>hello.cljs</code> in this new directory.</p><p>Add this to the contents of the file:</p>
<pre><code class="prettyprint lang-clj linenums">(ns try-cljs.hello)

(js/alert &quot;Hello World!&quot;)
</code></pre><p>Save that, and run the <code>lein cljsbuild once</code> which will compile this file, placing the output into <code>js/main.js</code> and <code>out/</code>. This is nice, but now we need an html file to get this going in a browser. Create a file in the root of your directory <code>hello.html</code>:</p>
<pre><code class="prettyprint lang-html linenums">&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
    &lt;body&gt;
        &lt;script src=&quot;js/main.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;goog.require(&quot;try_cljs.hello&quot;);&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Now, you should be able to open this page in your browser. When you do you should see the javascript alert pop up with "Hello World!" as the message.</p><h3>That was fun, but...</h3><p>So, now we have some ClojureScript compiling to javascript and running, but we're missing an important piece of our tool chain that makes Clojure a joy to work with: the REPL. Let's get that up and running next.</p><p>There are a few ways to get a repl running, for this post we will use the repl-listen option provided by lein-cljsbuild. First we must modify our hello.cljs file to look like:</p>
<pre><code class="prettyprint lang-clj linenums">(ns try-cljs.hello
  (:require [clojure.browser.repl :as repl]))

(repl/connect &quot;http://localhost:9000/repl&quot;)

(js/alert &quot;Hello World!&quot;)
</code></pre><p>Save and run <code>lein trampoline cljsbuild auto</code>. This differs from the <code>lein
cljsbuild once</code> in that we are only keeping the java instance that lein requires long enough to get our clojure process in proper order and for cljsbuild to monitor the cljs files for changes and auto compile them when they change. This is particuarly useful as we do not have to wait for the JVM to fire up everytime we want to compile, but at the price that a JVM instance stays alive until we kill the process.</p><p>Next, run <code>lein trampoline cljsbuild repl-listen</code>. This will fire up a ClojureScript REPL and you should see:</p>
<pre><code>Running ClojureScript REPL, listening on port 9000.
To quit, type: :cljs/quit
ClojureScript:cljs.user&gt;
</code></pre><p>Now, it's time to try out our page again. Instead of opening <code>hello.html</code> directly, navigate your browser to <code>http://localhost:9000/hello.html</code>. You should now see the same javascript alert from earlier. Now, in the ClojureScript REPL, we can interact with the page we just navigated to. Run <code>(js/alert &quot;The REPL works&quot;)</code> from the REPL. The message should appear as we would expect. </p><h3>All your browsers are belong to us?</h3><p>That is culmination of the knowledge I gained while working through the documentation for getting a ClojureScript REPL running in the browser. I particuarly struggled with connecting to the REPL as it was not immediately obvious how the connection was made. Google ended up not being much help, until I found this <a href="https://groups.google.com/forum/#!msg/clojure/BQa9WkRvloo/tyMnl0eWKFMJ">google group thread</a>. I discovered that all I needed to do was navigate to the <code>http://localhost:9000/</code>, not <code>http://localhost:9000/repl</code>. I was also using index.html instead of hello.html last night, hopefully this distinction is helpful in the URI's as I did not realize that port 9000 was serving pages from the root of my project. </p><p>I'm excited to experiment more with Clojure and ClojureScript. I'm likely going to give cemerick's <a href="https://github.com/cemerick/austin">Austin</a> a go next. I've created a github repository <a href="https://github.com/jprof/cljs-browser-repl-tutorial">here</a> that contains the complete code written in this post, so if you don't want to type it all out, go ahead and clone it!</p></p></div></div></div></div><div class="row"><div class="col-xs-12 col-sm-offset-1 col-sm-10 col-md-offset-2 col-md-8"><div class="center"><a href="/rss-feed"> RSS Feed </a><span>| &copy; 2014<a href="http://jprof.github.io/"> Justin Proffitt</a></span></div></div></div></div></div><script src="https://code.jquery.com/jquery-1.10.2.min.js" type="text/javascript"></script><script src="/bootstrap/boot3/js/bootstrap.js" type="text/javascript"></script></body></head></html>